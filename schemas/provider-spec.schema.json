{
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "$id": "https://specado.com/schemas/provider-spec.schema.json",
    "title": "ProviderSpec",
    "description": "Provider capability specification for LLM API translation",
    "type": "object",
    "additionalProperties": false,
    "required": ["spec_version", "provider", "models"],
    "properties": {
      "spec_version": {
        "description": "Specification version (semver)",
        "type": "string",
        "pattern": "^\\d+\\.\\d+\\.\\d+$"
      },
      "provider": {
        "type": "object",
        "additionalProperties": false,
        "required": ["name", "base_url", "headers"],
        "properties": {
          "name": { "type": "string", "minLength": 1 },
          "base_url": { "type": "string", "format": "uri" },
          "headers": {
            "type": "object",
            "description": "Static headers; values may include ${ENV:VAR} placeholders.",
            "additionalProperties": { "type": "string" }
          },
          "auth": {
            "description": "Optional. If omitted, authentication must be supplied via a templated header (e.g., Authorization: \"Bearer ${ENV:API_KEY}\").",
            "type": "object",
            "additionalProperties": false,
            "required": ["type", "header_name"],
            "properties": {
              "type": { 
                "description": "Authentication type",
                "type": "string", 
                "enum": ["bearer", "api-key", "basic", "custom"] 
              },
              "header_name": { 
                "description": "Header name for authentication",
                "type": "string", 
                "default": "Authorization" 
              },
              "value_template": { 
                "description": "Template for auth value (e.g., 'Bearer ${ENV:API_KEY}')",
                "type": "string" 
              }
            }
          },
          "extensions": {
            "description": "Provider-specific extensions and experimental features",
            "type": "object",
            "additionalProperties": true,
            "properties": {
              "auth": { "$ref": "#/$defs/AuthConfiguration" },
              "rate_limits": { "$ref": "#/$defs/RateLimits" },
              "validation_schemas": {
                "description": "References to additional validation schema files",
                "type": "array",
                "items": {
                  "type": "string",
                  "format": "uri-reference"
                }
              }
            }
          },
          "capabilities": {
            "description": "Provider-wide capabilities",
            "type": "object",
            "additionalProperties": false,
            "properties": {
              "supports_rag": { 
                "description": "Supports retrieval-augmented generation",
                "type": "boolean", 
                "default": false 
              },
              "supports_conversation_persistence": { 
                "description": "Supports persistent conversation IDs",
                "type": "boolean", 
                "default": false 
              },
              "supports_live_sessions": { 
                "description": "Supports live/streaming sessions",
                "type": "boolean", 
                "default": false 
              },
              "supports_multimodal_output": { 
                "description": "Can generate non-text outputs",
                "type": "boolean", 
                "default": false 
              }
            }
          }
        }
      },
  
      "models": {
        "type": "array",
        "minItems": 1,
        "items": { "$ref": "#/$defs/Model" }
      },
      
      "notes": {
        "description": "Additional notes about provider requirements or limitations",
        "type": "string"
      }
    },
  
    "$defs": {
      "Model": {
        "description": "Model specification within a provider",
        "type": "object",
        "additionalProperties": false,
        "required": ["id", "family", "endpoints", "input_modes", "tooling", "json_output", "parameters", "constraints", "mappings", "response_normalization"],
        "properties": {
          "description": {
            "description": "Model description and use cases",
            "type": "string"
          },
          "id": { 
            "description": "Model identifier",
            "type": "string", 
            "minLength": 1 
          },
          "aliases": { 
            "description": "Alternative names/aliases for the model",
            "type": "array", 
            "items": { "type": "string" }
          },
          "family": { 
            "description": "Model family (e.g., gpt-4, claude-3)",
            "type": "string", 
            "minLength": 1 
          },

          "capabilities": {
            "description": "Model capabilities (optional, inferred if not specified)",
            "type": "object",
            "additionalProperties": false,
            "properties": {
              "text_generation": {
                "description": "Supports text generation",
                "type": "boolean",
                "default": true
              },
              "vision": {
                "description": "Supports image/visual input",
                "type": "boolean",
                "default": false
              },
              "function_calling": {
                "description": "Supports function/tool calling",
                "type": "boolean",
                "default": false
              },
              "streaming": {
                "description": "Supports streaming responses",
                "type": "boolean",
                "default": false
              },
              "reasoning": {
                "description": "Supports enhanced reasoning capabilities",
                "type": "boolean"
              },
              "extended_context": {
                "description": "Supports extended context windows (>100k tokens)",
                "type": "boolean"
              },
              "multimodal": {
                "description": "Supported modalities beyond text",
                "type": "array",
                "items": {
                  "type": "string",
                  "enum": ["text", "image", "audio", "video"]
                }
              },
              "experimental": {
                "description": "Experimental or provider-specific capabilities",
                "type": "object",
                "additionalProperties": true
              }
            }
          },
  
          "endpoints": {
            "description": "API endpoints for this model",
            "type": "object",
            "additionalProperties": false,
            "required": ["chat_completion", "streaming_chat_completion"],
            "properties": {
              "chat_completion": { "$ref": "#/$defs/EndpointConfig" },
              "streaming_chat_completion": { "$ref": "#/$defs/EndpointConfig" }
            }
          },
  
          "input_modes": {
            "type": "object",
            "additionalProperties": false,
            "required": ["messages", "single_text", "images"],
            "properties": {
              "messages": { "type": "boolean" },
              "single_text": { "type": "boolean" },
              "images": { "type": "boolean" },
              "audio": { 
                "description": "Supports audio input",
                "type": "boolean",
                "default": false
              },
              "video": { 
                "description": "Supports video input",
                "type": "boolean",
                "default": false
              },
              "documents": { 
                "description": "Supports document/file input",
                "type": "boolean",
                "default": false
              }
            }
          },
  
          "tooling": {
            "type": "object",
            "additionalProperties": false,
            "required": ["tools_supported", "parallel_tool_calls_default", "can_disable_parallel_tool_calls"],
            "properties": {
              "tools_supported": { "type": "boolean" },
              "parallel_tool_calls_default": { "type": "boolean" },
              "can_disable_parallel_tool_calls": { "type": "boolean" },
              "disable_switch": {
                "type": "object",
                "additionalProperties": false,
                "required": ["path", "value"],
                "properties": {
                  "path": { 
                    "description": "Path to the boolean flag, specified as a JSONPath (provider-spec flavor)",
                    "type": "string", 
                    "minLength": 1 
                  },
                  "value": {}
                }
              },
              "extensions": {
                "description": "Additional tooling capabilities and experimental features",
                "type": "object",
                "additionalProperties": true,
                "properties": {
                  "tool_types": {
                    "description": "Supported tool types",
                    "type": "array",
                    "items": { "type": "string" }
                  },
                  "tool_choice_modes": {
                    "description": "Supported tool choice modes",
                    "type": "array",
                    "items": {
                      "type": "string",
                      "enum": ["auto", "none", "required", "any", "specific"]
                    }
                  },
                  "strict_tools_support": {
                    "description": "Supports strict tool schema validation",
                    "type": "boolean"
                  },
                  "context_free_grammars": {
                    "description": "Supports context-free grammar tools",
                    "type": "boolean"
                  },
                  "preambles_supported": {
                    "description": "Supports tool preambles",
                    "type": "boolean"
                  },
                  "custom_tools": {
                    "description": "Supports custom tool definitions",
                    "type": "boolean"
                  }
                }
              }
            }
          },
  
          "json_output": {
            "type": "object",
            "additionalProperties": false,
            "required": ["native_param", "strategy"],
            "properties": {
              "native_param": { "type": "boolean" },
              "strategy": { 
                "description": "Free-form; canonical values: json_schema, response_format, prompt_only (loader warns on others)",
                "type": "string" 
              },
              "notes": { "type": "string" }
            }
          },
  
          "parameters": {
            "description": "Parameter definitions for the model API",
            "type": "object",
            "additionalProperties": {
              "type": "object",
              "properties": {
                "type": { "type": "string" },
                "required": { "type": "boolean" },
                "description": { "type": "string" },
                "enum": {
                  "type": "array",
                  "items": {}
                },
                "default": {},
                "minimum": { "type": "number" },
                "maximum": { "type": "number" },
                "properties": { "type": "object" },
                "items": { "type": "object" }
              }
            }
          },
  
          "constraints": {
            "description": "Provider-specific constraints and limits",
            "type": "object",
            "additionalProperties": false,
            "required": ["system_prompt_location", "forbid_unknown_top_level_fields", "mutually_exclusive", "resolution_preferences", "limits"],
            "properties": {
              "system_prompt_location": { 
                "description": "Where system prompts are placed",
                "type": "string", 
                "enum": ["top_level", "message_role", "preamble", "first_message", "system_parameter"] 
              },
              "forbid_unknown_top_level_fields": { 
                "description": "Whether unknown fields cause errors",
                "type": "boolean" 
              },
              "mutually_exclusive": {
                "description": "Fields that cannot be used together",
                "type": "array",
                "items": {
                  "type": "array",
                  "minItems": 2,
                  "items": { "type": "string" }
                }
              },
              "resolution_preferences": {
                "description": "Conflict resolution order",
                "type": "array",
                "items": { "type": "string" }
              },
              "required_fields": {
                "description": "Provider-required top-level parameter names (for loader linting)",
                "type": "array",
                "items": { "type": "string" }
              },
              "limits": {
                "description": "Size limits for various fields",
                "type": "object",
                "additionalProperties": false,
                "required": ["max_tool_schema_bytes", "max_system_prompt_bytes"],
                "properties": {
                  "max_tool_schema_bytes": { "type": "integer", "minimum": 0 },
                  "max_system_prompt_bytes": { "type": "integer", "minimum": 0 }
                }
              },
              "extensions": {
                "description": "Additional constraint configurations and experimental features",
                "type": "object",
                "additionalProperties": true,
                "properties": {
                  "prompt_truncation": { "$ref": "#/$defs/PromptTruncation" }
                }
              }
            }
          },

          "mappings": {
            "description": "Field mappings from uniform to provider format",
            "type": "object",
            "additionalProperties": false,
            "required": ["paths", "flags"],
            "properties": {
              "paths": {
                "description": "JSONPath mappings for fields",
                "type": "object",
                "additionalProperties": { "type": "string" }
              },
              "flags": {
                "description": "Feature flags and their mappings",
                "type": "object",
                "additionalProperties": true
              },
              "extensions": {
                "description": "Additional mapping configurations and transformations",
                "type": "object",
                "additionalProperties": true,
                "properties": {
                  "transformations": { "$ref": "#/$defs/TransformationRules" }
                }
              }
            }
          },


          "response_normalization": {
            "description": "Rules for normalizing provider responses",
            "type": "object",
            "additionalProperties": false,
            "required": ["sync", "stream"],
            "properties": {
              "sync": {
                "description": "Synchronous response normalization",
                "type": "object",
                "additionalProperties": false,
                "required": ["content_path", "finish_reason_path", "finish_reason_map"],
                "properties": {
                  "content_path": { 
                    "description": "Must be valid JSONPath; loader pre-parses and errors on syntax",
                    "type": "string"
                  },
                  "finish_reason_path": { 
                    "description": "Must be valid JSONPath; loader pre-parses and errors on syntax",
                    "type": "string"
                  },
                  "finish_reason_map": {
                    "description": "Map provider finish reasons to uniform ones",
                    "type": "object",
                    "additionalProperties": { "type": "string" }
                  },
                  "reasoning_path": { 
                    "description": "Must be valid JSONPath; loader pre-parses and errors on syntax",
                    "type": "string"
                  },
                  "tool_calls_path": { 
                    "description": "Must be valid JSONPath; loader pre-parses and errors on syntax",
                    "type": "string"
                  },
                  "response_id_path": { 
                    "description": "JSONPath to response ID",
                    "type": "string"
                  },
                  "incomplete_details_path": { 
                    "description": "JSONPath to incomplete details",
                    "type": "string"
                  },
                  "output_array_path": { 
                    "description": "JSONPath to output array",
                    "type": "string"
                  },
                  "model_path": {
                    "description": "JSONPath to model identifier in response",
                    "type": "string"
                  },
                  "usage_path": {
                    "description": "Must be valid JSONPath; loader pre-parses and errors on syntax",
                    "type": "string"
                  }
                }
              },
              "stream": {
                "description": "Stream response normalization",
                "type": "object",
                "additionalProperties": false,
                "required": ["protocol", "event_selector"],
                "properties": {
                  "protocol": { 
                    "description": "Streaming technology (over transport protocol)",
                    "type": "string",
                    "enum": ["sse", "websocket", "ndjson", "http2-stream"]
                  },
                  "event_selector": {
                    "description": "Event routing rules",
                    "type": "object",
                    "additionalProperties": false,
                    "required": ["type_path", "routes"],
                    "properties": {
                      "type_path": { 
                        "description": "Must be valid JSONPath; loader pre-parses and errors on syntax",
                        "type": "string"
                      },
                      "routes": {
                        "description": "Event routing configuration",
                        "type": "array",
                        "items": {
                          "type": "object",
                          "additionalProperties": false,
                          "required": ["when", "emit"],
                          "properties": {
                            "when": { 
                              "description": "Event type to match",
                              "type": "string" 
                            },
                            "emit": { 
                              "description": "Event to emit",
                              "type": "string",
                              "enum": ["start", "delta", "tool", "stop", "error", "custom"]
                            },
                            "text_path": { 
                              "description": "Must be valid JSONPath; loader pre-parses and errors on syntax",
                              "type": "string"
                            },
                            "name_path": { 
                              "description": "Must be valid JSONPath; loader pre-parses and errors on syntax",
                              "type": "string"
                            },
                            "args_path": { 
                              "description": "Must be valid JSONPath; loader pre-parses and errors on syntax",
                              "type": "string"
                            },
                            "extensions": {
                              "description": "Route-specific extensions (required if emit is 'custom')",
                              "type": "object",
                              "additionalProperties": true
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },

          "extensions": {
            "description": "Model-specific extensions and experimental features",
            "type": "object",
            "additionalProperties": true,
            "properties": {
              "reasoning": { "$ref": "#/$defs/ReasoningCapabilities" },
              "verbosity": { "$ref": "#/$defs/VerbosityControl" },
              "thinking": { "$ref": "#/$defs/ThinkingCapabilities" },
              "conversation_management": { "$ref": "#/$defs/ConversationManagement" },
              "rag_config": { "$ref": "#/$defs/RagConfiguration" }
            }
          }
        }
      },
  
      "EndpointConfig": {
        "description": "API endpoint configuration",
        "type": "object",
        "additionalProperties": false,
        "required": ["method", "path", "protocol"],
        "properties": {
          "method": { 
            "description": "HTTP method",
            "type": "string", 
            "enum": ["POST", "GET", "PUT", "PATCH", "DELETE"] 
          },
          "path": { 
            "description": "URL path",
            "type": "string", 
            "pattern": "^/.*" 
          },
          "protocol": {
            "description": "Transport protocol",
            "type": "string",
            "enum": ["http", "https", "ws", "wss"]
          },
          "query": {
            "description": "Query parameters",
            "type": "object",
            "additionalProperties": { "type": "string" }
          },
          "headers": {
            "description": "Additional headers for this endpoint",
            "type": "object",
            "additionalProperties": { "type": "string" }
          }
        }
      },

      "PromptTruncation": {
        "description": "Prompt truncation strategy configuration",
        "type": "object",
        "additionalProperties": false,
        "properties": {
          "default_mode": {
            "description": "Default truncation mode",
            "type": "string",
            "enum": ["OFF", "AUTO", "AUTO_PRESERVE_ORDER", "START", "END"]
          },
          "supported_modes": {
            "description": "List of supported truncation modes",
            "type": "array",
            "items": {
              "type": "string",
              "enum": ["OFF", "AUTO", "AUTO_PRESERVE_ORDER", "START", "END"]
            }
          }
        }
      },

      "AuthConfiguration": {
        "description": "Authentication configuration",
        "type": "object",
        "additionalProperties": false,
        "properties": {
          "type": { 
            "description": "Authentication type",
            "type": "string", 
            "enum": ["bearer", "api-key", "basic", "custom"] 
          },
          "header_name": { 
            "description": "Header name for authentication",
            "type": "string", 
            "default": "Authorization" 
          },
          "value_template": { 
            "description": "Template for auth value (e.g., 'Bearer ${ENV:API_KEY}')",
            "type": "string" 
          }
        }
      },

      "RateLimits": {
        "description": "Rate limiting configuration",
        "type": "object",
        "additionalProperties": false,
        "properties": {
          "requests_per_minute": {
            "description": "Maximum requests per minute",
            "type": "integer",
            "minimum": 0
          },
          "tokens_per_minute": {
            "description": "Maximum tokens per minute",
            "type": "integer",
            "minimum": 0
          },
          "concurrent_requests": {
            "description": "Maximum concurrent requests",
            "type": "integer",
            "minimum": 1
          }
        }
      },

      "ToolingCapabilities": {
        "description": "Extended tooling capabilities",
        "type": "object",
        "additionalProperties": false,
        "properties": {
          "tool_types": {
            "description": "Supported tool types",
            "type": "array",
            "items": { "type": "string" }
          },
          "tool_choice_modes": {
            "description": "Supported tool choice modes",
            "type": "array",
            "items": {
              "type": "string",
              "enum": ["auto", "none", "required", "any", "specific"]
            }
          },
          "strict_tools_support": {
            "description": "Supports strict tool schema validation",
            "type": "boolean"
          },
          "context_free_grammars": {
            "description": "Supports context-free grammar tools",
            "type": "boolean"
          },
          "preambles_supported": {
            "description": "Supports tool preambles",
            "type": "boolean"
          },
          "custom_tools": {
            "description": "Supports custom tool definitions",
            "type": "boolean"
          }
        }
      },

      "TransformationRules": {
        "description": "Data transformation rules",
        "type": "object",
        "additionalProperties": {
          "type": "object",
          "properties": {
            "description": { "type": "string" },
            "type": { "type": "string" },
            "separator": { "type": "string" }
          }
        }
      },

      "ReasoningCapabilities": {
        "description": "Reasoning capabilities configuration",
        "type": "object",
        "additionalProperties": false,
        "properties": {
          "supported": { "type": "boolean" },
          "effort_levels": {
            "type": "array",
            "items": { "type": "string" }
          },
          "default_effort": { "type": "string" },
          "internal_chain_of_thought": { "type": "boolean" },
          "optimized_for": { "type": "string" },
          "summary_modes": {
            "type": "array",
            "items": { "type": "string" }
          },
          "default_summary": { "type": "string" }
        }
      },

      "VerbosityControl": {
        "description": "Verbosity control capabilities",
        "type": "object",
        "additionalProperties": false,
        "properties": {
          "supported": { "type": "boolean" },
          "levels": {
            "type": "array",
            "items": { "type": "string" }
          },
          "default_level": { "type": "string" }
        }
      },

      "ThinkingCapabilities": {
        "description": "Extended thinking/reasoning capabilities",
        "type": "object",
        "additionalProperties": false,
        "properties": {
          "supported": { "type": "boolean" },
          "type": { "type": "string" },
          "budget_tokens_min": { "type": "integer" },
          "budget_tokens_max": { "type": "integer" },
          "default_budget": { "type": "integer" }
        }
      },

      "ConversationManagement": {
        "description": "Conversation persistence configuration",
        "type": "object",
        "additionalProperties": false,
        "properties": {
          "conversation_id_param": {
            "description": "Parameter name for conversation ID",
            "type": "string"
          },
          "history_param": {
            "description": "Parameter name for chat history",
            "type": "string"
          },
          "supports_branching": {
            "description": "Whether conversations can branch",
            "type": "boolean"
          }
        }
      },

      "RagConfiguration": {
        "description": "Retrieval-augmented generation configuration",
        "type": "object",
        "additionalProperties": false,
        "properties": {
          "connector_param": {
            "description": "Parameter name for RAG connectors",
            "type": "string"
          },
          "document_param": {
            "description": "Parameter name for documents",
            "type": "string"
          },
          "search_queries_param": {
            "description": "Parameter name for search queries only mode",
            "type": "string"
          },
          "web_search_connector": {
            "description": "Identifier for web search connector",
            "type": "string"
          }
        }
      }
    }
  }
  