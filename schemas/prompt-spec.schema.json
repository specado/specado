{
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "$id": "https://specado.com/schemas/prompt-spec.schema.json",
    "title": "PromptSpec",
    "description": "Uniform prompt specification for LLM providers",
    "type": "object",
    "additionalProperties": false,
    "required": ["model_class", "messages", "strict_mode"],
    "properties": {
      "model_class": {
        "description": "Model capability class determining behavior",
        "type": "string",
        "enum": [
          "Chat",
          "ReasoningChat",
          "VisionChat",
          "AudioChat", 
          "MultimodalChat",
          "RAGChat",
          "Completion",
          "Embedding"
        ]
      },
  
      "messages": {
        "description": "Conversation messages",
        "type": "array",
        "minItems": 1,
        "items": { "$ref": "#/$defs/Message" }
      },
  
      "rag": {
        "description": "Retrieval-augmented generation configuration",
        "type": "object",
        "additionalProperties": false,
        "properties": {
          "documents": {
            "description": "A corpus of documents for the model to retrieve from during RAG operations",
            "type": "array",
            "items": {
              "type": "object",
              "additionalProperties": false,
              "required": ["id", "content"],
              "properties": {
                "id": { 
                  "description": "Document identifier",
                  "type": "string" 
                },
                "content": { 
                  "description": "Document content",
                  "type": "string" 
                },
                "metadata": { 
                  "description": "Document metadata",
                  "type": "object" 
                }
              }
            }
          },
          "connectors": {
            "description": "RAG connectors to use",
            "type": "array",
            "items": { 
              "type": "string",
              "description": "Connector identifier (e.g., web_search, database, file_system)"
            }
          },
          "search_queries": {
            "description": "Search queries for retrieval",
            "type": "array",
            "items": { 
              "type": "string" 
            }
          },
          "citations_required": {
            "description": "Whether to include citations in response",
            "type": "boolean",
            "default": false
          },
          "max_results": {
            "description": "Maximum number of results to retrieve",
            "type": "integer",
            "minimum": 1
          }
        }
      },
  
      "conversation": {
        "description": "Conversation management settings",
        "type": "object",
        "additionalProperties": false,
        "properties": {
          "conversation_id": {
            "description": "Persistent conversation identifier",
            "type": "string"
          },
          "parent_message_id": {
            "description": "Parent message ID for conversation branching",
            "type": "string"
          },
          "preserve_history": {
            "description": "Whether to preserve conversation history",
            "type": "boolean",
            "default": true
          },
          "branch_from": {
            "description": "Message ID to branch conversation from",
            "type": "string"
          }
        }
      },
  
      "tools": {
        "description": "Available tools for the model to use",
        "type": "array",
        "items": { "$ref": "#/$defs/Tool" }
      },
  
      "tool_choice": {
        "description": "Tool selection strategy",
        "oneOf": [
          { "const": "auto" },
          { "const": "none" },
          { "const": "required" },
          { "const": "any" },
          {
            "type": "object",
            "additionalProperties": false,
            "required": ["name"],
            "properties": {
              "name": { 
                "description": "Specific tool to use",
                "type": "string", 
                "minLength": 1 
              }
            }
          }
        ]
      },
  
      "response_format": {
        "description": "Expected response format",
        "oneOf": [
          { "const": "text" },
          { "const": "json_object" },
          {
            "type": "object",
            "additionalProperties": false,
            "required": ["json_schema"],
            "properties": {
              "json_schema": {
                "description": "JSON Schema for structured output",
                "type": "object"
              },
              "strict": { 
                "description": "Enforce strict schema validation",
                "type": "boolean", 
                "default": false 
              }
            }
          }
        ]
      },
  
      "sampling": {
        "description": "Sampling parameters for generation",
        "type": "object",
        "additionalProperties": false,
        "properties": {
          "temperature": { 
            "type": "number", 
            "minimum": 0, 
            "maximum": 2,
            "description": "Controls randomness (0=deterministic, 2=very random)" 
          },
          "top_p": { 
            "type": "number", 
            "minimum": 0, 
            "maximum": 1,
            "description": "Nucleus sampling threshold" 
          },
          "top_k": { 
            "type": "integer", 
            "minimum": 1,
            "description": "Top-k sampling parameter" 
          },
          "frequency_penalty": { 
            "type": "number",
            "minimum": -2,
            "maximum": 2,
            "description": "Penalize frequently used tokens" 
          },
          "presence_penalty": { 
            "type": "number",
            "minimum": -2,
            "maximum": 2,
            "description": "Penalize tokens that have appeared" 
          }
        }
      },
  
      "limits": {
        "description": "Token and output limits",
        "type": "object",
        "additionalProperties": false,
        "properties": {
          "max_output_tokens": { 
            "type": "integer", 
            "minimum": 1,
            "description": "Maximum tokens in response" 
          },
          "reasoning_tokens": { 
            "type": "integer", 
            "minimum": 1,
            "description": "Tokens for reasoning (ReasoningChat models)" 
          },
          "max_prompt_tokens": {
            "type": "integer",
            "minimum": 1,
            "description": "Maximum tokens in prompt"
          }
        }
      },
  
      "media": {
        "description": "Media inputs and outputs",
        "type": "object",
        "additionalProperties": false,
        "properties": {
          "input_images": { 
            "description": "Images to include in prompt",
            "type": "array",
            "items": {
              "oneOf": [
                {
                  "type": "string",
                  "description": "Base64 encoded image or URL"
                },
                {
                  "type": "object",
                  "description": "Image with metadata"
                }
              ]
            }
          },
          "input_audio": { 
            "description": "Audio input configuration",
            "type": "object",
            "additionalProperties": false,
            "properties": {
              "url": { 
                "description": "Audio file URL",
                "type": "string" 
              },
              "data": { 
                "description": "Base64 encoded audio data",
                "type": "string" 
              },
              "format": { 
                "description": "Audio format (e.g., mp3, wav, m4a)",
                "type": "string" 
              }
            }
          },
          "input_video": {
            "description": "Video input configuration",
            "type": "object",
            "additionalProperties": false,
            "properties": {
              "url": { 
                "description": "Video file URL",
                "type": "string" 
              },
              "data": { 
                "description": "Base64 encoded video data",
                "type": "string" 
              },
              "format": { 
                "description": "Video format (e.g., mp4, webm, mov)",
                "type": "string" 
              },
              "duration_seconds": {
                "description": "Video duration in seconds",
                "type": "number",
                "minimum": 0
              }
            }
          },
          "input_documents": {
            "description": "Documents to be included directly in the prompt's context (not for retrieval)",
            "type": "array",
            "items": {
              "type": "object",
              "additionalProperties": false,
              "required": ["name", "content"],
              "properties": {
                "name": { 
                  "description": "Document name/filename",
                  "type": "string" 
                },
                "content": { 
                  "description": "Document content (text or base64)",
                  "type": "string" 
                },
                "mime_type": { 
                  "description": "MIME type of the document",
                  "type": "string" 
                },
                "encoding": {
                  "description": "Content encoding (text, base64)",
                  "type": "string",
                  "enum": ["text", "base64"],
                  "default": "text"
                }
              }
            }
          },
          "output_audio": { 
            "description": "Audio output configuration",
            "type": "object"
          }
        }
      },
  
      "preferences": {
        "description": "User preferences for translation behavior",
        "type": "object",
        "additionalProperties": false,
        "properties": {
          "prompt_truncation": {
            "description": "How to handle prompts that exceed token limits",
            "type": "string",
            "enum": ["OFF", "AUTO", "AUTO_PRESERVE_ORDER"],
            "default": "AUTO"
          },
          "fallback_behavior": {
            "description": "How to handle unsupported features",
            "type": "string",
            "enum": ["strict", "adaptive", "permissive"],
            "default": "adaptive"
          },
          "citation_format": {
            "description": "Preferred citation format for RAG responses",
            "type": "string",
            "enum": ["inline", "footnote", "bibliography"],
            "default": "inline"
          },
          "parallel_tool_calls": {
            "description": "Preference for parallel tool execution",
            "type": "boolean",
            "default": true
          }
        }
      },
  
      "strict_mode": {
        "description": "Strictness policy for translation",
        "type": "string",
        "enum": ["Strict", "Warn", "Coerce"],
        "default": "Warn"
      }
    },
  
    "$defs": {
      "Message": {
        "description": "A message in the conversation",
        "type": "object",
        "additionalProperties": false,
        "required": ["role", "content"],
        "properties": {
          "role": { 
            "description": "Role of the message sender",
            "type": "string", 
            "enum": ["system", "user", "assistant", "tool"]
          },
          "content": { 
            "description": "Message content",
            "type": "string" 
          },
          "metadata": {
            "description": "Optional metadata for the message",
            "type": "object"
          }
        }
      },
  
      "Tool": {
        "description": "Tool definition for function calling",
        "type": "object",
        "additionalProperties": false,
        "required": ["name", "json_schema"],
        "properties": {
          "name": { 
            "description": "Tool name (must be valid identifier)",
            "type": "string", 
            "pattern": "^[a-zA-Z_][a-zA-Z0-9_]*$",
            "minLength": 1,
            "maxLength": 64
          },
          "description": { 
            "description": "Human-readable description of what the tool does",
            "type": "string",
            "maxLength": 1024
          },
          "json_schema": {
            "description": "JSON Schema for the tool's parameters (object for parameters, boolean for parameter-less)",
            "oneOf": [
              { "type": "object" },
              { "type": "boolean" }
            ]
          }
        }
      }
    }
  }
  